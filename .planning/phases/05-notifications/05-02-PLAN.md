---
phase: 05-notifications
plan: 02
type: execute
wave: 2
depends_on: [05-01]
files_modified:
  - application/controllers/Notification.php
  - application/views/notification/index.php
  - application/views/layout/nav.php
  - application/views/layout/template.php
autonomous: true
must_haves:
  truths:
    - "Pegawai can see their notification list and unread count"
    - "Admin can see their notification list and unread count"
    - "User can mark notifications as read"
  artifacts:
    - path: "application/controllers/Notification.php"
      provides: "notification list and mark-read endpoints"
      contains: "index"
    - path: "application/views/notification/index.php"
      provides: "notification list UI"
      min_lines: 30
    - path: "application/views/layout/nav.php"
      provides: "notification link + badge"
      contains: "notification"
  key_links:
    - from: "application/controllers/Notification.php"
      to: "application/models/Notification_model.php"
      via: "get_by_user/mark_read"
      pattern: "Notification_model"
    - from: "application/views/layout/nav.php"
      to: "application/controllers/Notification.php"
      via: "site_url('notification')"
      pattern: "notification"
---

<objective>
Expose in-app notifications to users via a list UI, unread badge, and mark-read action.

Purpose: Make notification data visible and actionable for admins and pegawai.
Output: Notification controller + list view + nav badge.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@application/views/layout/template.php
@application/views/layout/nav.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Notification controller for list + mark read</name>
  <files>application/controllers/Notification.php</files>
  <action>
Create Notification controller with role-guarded access (check_not_login, allow admin and pegawai). Load Notification_model.
Methods:
- index(): fetch notifications for current user (limit 50, newest first) and pass to view.
- mark_read($id): mark notification as read for current user, redirect back to notification list.
Use flash messages for errors.
  </action>
  <verify>php -l application/controllers/Notification.php</verify>
  <done>Notification controller serves list and mark-read actions with auth guards.</done>
</task>

<task type="auto">
  <name>Task 2: Build notification list view + nav badge</name>
  <files>application/views/notification/index.php, application/views/layout/nav.php, application/views/layout/template.php</files>
  <action>
Create notification list view showing title, message, type, created_at, and read state.
Add button/link to mark unread notifications as read.
Add a nav entry for Notifications with unread badge count. The badge count can be fetched from a shared $unread_notifications variable injected in template.
Update layout/template.php to compute unread count using Notification_model for logged-in user and pass to nav view.
  </action>
  <verify>php -l application/views/notification/index.php application/views/layout/template.php</verify>
  <done>Users can open notification list and see unread badge; unread items can be marked read.</done>
</task>

</tasks>

<verification>
- Notification list loads for admin and pegawai
- Unread badge visible when count > 0
</verification>

<success_criteria>
- Users can access /notification and mark items read
- Navbar displays unread count for logged-in user
</success_criteria>

<output>
After completion, create `.planning/phases/05-notifications/05-02-SUMMARY.md`
</output>
