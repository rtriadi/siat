---
phase: 01-project-setup
plan: 04
type: execute
wave: 3
depends_on:
  - "01-01"
  - "01-02"
  - "01-03"
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Application loads successfully at http://localhost"
    - "Login page is accessible and renders correctly with all assets"
    - "Admin can log in with default credentials (admin/admin123)"
    - "After login, user is redirected to dashboard with session established"
    - "Base URL is correct in all links and asset paths"
  artifacts: []
  key_links:
    - from: "Login form"
      to: "Auth controller"
      via: "form submission to auth/user_login"
      pattern: "action.*auth"
    - from: "Auth controller"
      to: "Database"
      via: "mysqli connection with development credentials"
      pattern: "mysqli.*connect"
    - from: "Session creation"
      to: "Dashboard redirect"
      via: "successful authentication flow"
      pattern: "set_userdata.*redirect"
---

<objective>
Verify that complete project setup works end-to-end.

Purpose: Confirms all Phase 1 changes work together - dynamic base URL serves assets correctly, environment-specific database configuration connects successfully, bcrypt authentication works for both new passwords and SHA1 migration, and the application is ready for feature development.

Output: Human-verified confirmation that developer can run the application locally, log in successfully, and access the dashboard.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-project-setup--and--configuration/01-01-PLAN.md
@.planning/phases/01-project-setup--and--configuration/01-02-PLAN.md
@.planning/phases/01-project-setup--and--configuration/01-03-PLAN.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete project setup: dynamic base URL configuration, environment-specific database credentials, bcrypt password hashing with SHA1 migration, and initialized database with admin account.
  </what-built>
  
  <how-to-verify>
**Step 1: Start local development server**
```bash
# If using XAMPP
# Start Apache and MySQL from XAMPP control panel

# If using built-in PHP server
php -S localhost:8080 -t .
```

**Step 2: Verify base URL and asset loading**
1. Open browser and navigate to: http://localhost (or http://localhost:8080 if using PHP built-in server)
2. Open browser DevTools (F12) → Network tab
3. Reload the page
4. Check that:
   - All CSS files load successfully (200 status)
   - All JS files load successfully (200 status)
   - No 404 errors for assets
   - Asset URLs start with correct base URL (http://localhost)

**Step 3: Verify database connection**
1. Check that login page renders (you should see a login form, not a database error)
2. If you see "Unable to connect to database" error, verify:
   - MySQL is running
   - siat_db database exists (`mysql -u root -e "SHOW DATABASES LIKE 'siat_db';"`)
   - Credentials in application/config/development/database.php match your MySQL setup

**Step 4: Test authentication with default admin account**
1. On login page, enter:
   - Username: `admin`
   - Password: `admin123`
2. Click "Login" button
3. Verify:
   - No error messages appear
   - You are redirected to dashboard or welcome page
   - URL changes (e.g., from /auth/login to /dashboard or /welcome)
   - Page shows user information or admin interface

**Step 5: Verify session persistence**
1. After successful login, reload the page
2. Verify you remain logged in (not redirected back to login)
3. Check session: Username or user ID should be visible in UI

**Step 6: Test bcrypt password hash migration (optional)**
If you have existing users with SHA1 passwords:
1. Log in with old SHA1 account
2. After successful login, check database:
   ```bash
   mysql -u root siat_db -e "SELECT id_user, username, LENGTH(password) as hash_length FROM user WHERE username='admin';"
   ```
3. Verify password hash length changed from 40 (SHA1) to ~60 (bcrypt starting with $2y$)

**Step 7: Verify composer dependencies**
```bash
composer validate
```
Expected output: "composer.json and composer.lock are valid"

**Expected Results:**
- ✅ Application loads without errors
- ✅ All assets (CSS/JS) load correctly
- ✅ Login page renders properly
- ✅ Admin login successful with admin/admin123
- ✅ Redirect to dashboard after login
- ✅ Session persists across page reloads
- ✅ Composer lock file is valid
  </how-to-verify>
  
  <resume-signal>
Type "approved" if all verification steps pass, or describe any issues encountered (e.g., "database connection failed", "assets not loading", "login fails").
  </resume-signal>
</task>

</tasks>

<verification>
Phase 1 complete when all success criteria verified:

1. **Environment configuration works:**
   - Base URL detected correctly from HTTP_HOST
   - Assets load from correct base URL
   - No hardcoded URLs causing issues

2. **Database connectivity works:**
   - Application connects to siat_db database
   - Environment-specific credentials loaded correctly
   - No database connection errors

3. **Authentication security upgraded:**
   - Admin can log in with bcrypt password
   - SHA1 migration works (if tested)
   - Sessions established correctly

4. **Reproducible builds enabled:**
   - composer.lock committed and valid
   - Dependencies locked to specific versions
</verification>

<success_criteria>
- [ ] Application accessible at http://localhost
- [ ] All CSS and JavaScript assets load without 404 errors
- [ ] Login page renders correctly with AdminLTE styling
- [ ] Default admin login works (username: admin, password: admin123)
- [ ] Successful login redirects to dashboard and establishes session
- [ ] Session persists across page reloads
- [ ] composer.lock file is valid
- [ ] No database connection errors
- [ ] Development environment is fully operational
</success_criteria>

<output>
After human approval, create `.planning/phases/01-project-setup--and--configuration/01-04-SUMMARY.md`
</output>
