---
phase: 02-authentication--and--user-management
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - application/controllers/Dashboard.php
  - application/controllers/Pegawai.php
  - application/views/dashboard.php
  - application/views/pegawai/dashboard.php
  - application/controllers/Auth.php
  - application/helpers/fungsi_helper.php
autonomous: true

must_haves:
  truths:
    - "Admin lands on an admin dashboard after login"
    - "Pegawai lands on a pegawai dashboard after login"
  artifacts:
    - path: application/controllers/Dashboard.php
      provides: "Admin dashboard controller with check_admin guard"
    - path: application/controllers/Pegawai.php
      provides: "Pegawai dashboard controller with check_pegawai guard"
    - path: application/views/dashboard.php
      provides: "Admin dashboard view"
    - path: application/views/pegawai/dashboard.php
      provides: "Pegawai dashboard view"
  key_links:
    - from: application/controllers/Auth.php
      to: "Dashboard.php / Pegawai.php"
      via: "role-based redirect"
      pattern: "redirect\(.*dashboard|pegawai"
    - from: application/controllers/Dashboard.php
      to: application/helpers/fungsi_helper.php
      via: "check_admin()"
      pattern: "check_admin\(\)"
---

<objective>
Provide role-based landing pages so admin and pegawai have distinct post-login destinations.

Purpose: Complete AUTH-01 by delivering role-specific access points.
Output: Admin and pegawai dashboard controllers/views with role-based redirects.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@application/controllers/Auth.php
@application/helpers/fungsi_helper.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create admin dashboard controller + view</name>
  <files>application/controllers/Dashboard.php, application/views/dashboard.php</files>
  <action>
Create Dashboard controller that loads Template layout and guards with `check_not_login()` + `check_admin()`. Add a simple admin dashboard view with page title and placeholder content for admin actions. Keep naming consistent with existing template usage.
  </action>
  <verify>php -l application/controllers/Dashboard.php</verify>
  <done>/dashboard route renders an admin-only page via Template layout</done>
</task>

<task type="auto">
  <name>Task 2: Create pegawai dashboard controller + view</name>
  <files>application/controllers/Pegawai.php, application/views/pegawai/dashboard.php</files>
  <action>
Create Pegawai controller that guards with `check_not_login()` + `check_pegawai()` and loads a pegawai dashboard view. Keep view minimal (header + placeholder) and use Template layout.
  </action>
  <verify>php -l application/controllers/Pegawai.php</verify>
  <done>/pegawai route renders a pegawai-only page via Template layout</done>
</task>

<task type="auto">
  <name>Task 3: Redirect login and already-login checks by role</name>
  <files>application/controllers/Auth.php, application/helpers/fungsi_helper.php</files>
  <action>
Update Auth login success to redirect Admin (level=1) to `/dashboard` and Pegawai (level=2) to `/pegawai`. Update `check_already_login()` to route to the correct dashboard based on session `level` instead of always `/dashboard`.
  </action>
  <verify>php -l application/controllers/Auth.php && php -l application/helpers/fungsi_helper.php</verify>
  <done>Admin and pegawai users land on their respective dashboards after login</done>
</task>

</tasks>

<verification>
- php -l on new/modified PHP files passes
- Role-based login redirects are defined in Auth
</verification>

<success_criteria>
- Admin sees admin dashboard after login
- Pegawai sees pegawai dashboard after login
</success_criteria>

<output>
After completion, create `.planning/phases/02-authentication--and--user-management/02-02-SUMMARY.md`
</output>
